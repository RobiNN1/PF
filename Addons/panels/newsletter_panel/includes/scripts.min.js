$((function(){function e(){$("#editor-container").css("height",parseInt($(window).height())>1019?parseInt($(window).height())-439:580)}$("#tpl_file").change((function(){"none"===$(this).val()?$("#tpl-text").show():$("#tpl-text").hide()})),e(),$(window).resize(e)}));let editor=grapesjs.init({cssIcons:"",container:"#gjs",height:"100%",width:"100%",avoidInlineStyle:!0,noticeOnUnload:!1,plugins:["gjs-preset-newsletter",e=>{e.Panels.addButton("options",[{id:"undo",className:"",label:'<i class="fa fa-undo"></i>',command:"undo",attributes:{title:"Undo (CTRL/CMD + Z)"}},{id:"redo",className:"",label:'<i class="fa fa-redo"></i>',command:"redo",attributes:{title:"Redo (CTRL/CMD + SHIFT + Z)"}}])}],fromElement:!0,storageManager:{type:null},storageType:"",storeOnChange:!0,storeAfterUpload:!0,assetManager:{storageType:"",storeOnChange:!0,storeAfterUpload:!0,upload:SITE_URL+"infusions/newsletter_panel/includes/upload.php"+AID,uploadName:"files",multiUpload:!0,assets:[],uploadFile:function(e){let t=e.dataTransfer?e.dataTransfer.files:e.target.files,o=new FormData;for(let e in t)o.append("file-"+e,t[e]);$.ajax({url:SITE_URL+"infusions/newsletter_panel/includes/upload.php"+AID,type:"POST",data:o,contentType:!1,crossDomain:!0,dataType:"json",mimeType:"multipart/form-data",processData:!1,success:function(e){let t=[];$.each(e.data,(function(e,o){t[e]=o}));let o=t;editor.AssetManager.add(o)}})}}});editor.on("load",(function(){editor.Panels.removeButton("options","gjs-toggle-images"),editor.Panels.removeButton("options","gjs-open-import-template"),editor.Panels.removeButton("options","export-template")})),editor.RichTextEditor.add("custom-vars",{icon:'<select class="gjs-field">\n        <option value="">- Select -</option>\n        <option value="[TITLE]">[TITLE] - Template name/Subject</option>\n        <option value="[LOGO]">[LOGO] - Site logo</option>\n        <option value="[SITENAME]">[SITENAME] - Site name</option>\n        <option value="[SITEURL]">[SITEURL] - Site URL</option>\n        <option value="[SITE_COPYRIGHT]">[SITE_COPYRIGHT] - Site copyright</option>\n        <option value="[EMAIL]">[EMAIL] - Subscriber email</option>\n        <option value="[UNSUBSCRIBE]">[UNSUBSCRIBE] - Unsubscribe link</option>\n      </select>',event:"change",result:(e,t)=>e.insertHTML(t.btn.firstChild.value),update:(e,t)=>{t.btn.firstChild.value=""}}),editor.addComponents("<style>"+TPL_STYLE+"</style>");const htmlTextarea=document.getElementById("tpl_body"),cssTextarea=document.getElementById("tpl_style"),updateTextarea=(e,t)=>{const o=e.em.get("Editor");htmlTextarea.value=o.getHtml(),cssTextarea.value=o.getCss()};editor.on("component:add",updateTextarea),editor.on("component:update",updateTextarea),editor.on("component:remove",updateTextarea);